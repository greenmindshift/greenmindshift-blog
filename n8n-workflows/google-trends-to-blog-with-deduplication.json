{
  "name": "Google Trends zu Blog Post (mit Duplikatserkennung)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 24
            }
          ]
        }
      },
      "id": "cron-trigger",
      "name": "T√§glich um 9:00 Uhr",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://trends.google.com/trends/api/dailytrends",
        "options": {
          "queryParameters": {
            "hl": "de",
            "tz": "-60",
            "geo": "DE",
            "ns": "15"
          }
        }
      },
      "id": "google-trends",
      "name": "Google Trends abrufen",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "jsCode": "const crypto = require('crypto');\n\n// Filtere Trends nach Nachhaltigkeit Keywords\nconst sustainabilityKeywords = [\n  'nachhaltigkeit', 'sustainability', 'klimaschutz', 'umwelt',\n  'erneuerbare energie', 'solar', 'wind', 'elektro',\n  'recycling', 'bio', '√∂ko', 'green', 'klimawandel',\n  'elektroauto', 'vegan', 'fairtrade', 'co2', 'emission'\n];\n\nconst trendsData = JSON.parse($input.all()[0].json.body.substring(5)); // Remove )]}' prefix\nconst relevantTrends = [];\n\nfor (const day of trendsData.default.trendingSearchesDays) {\n  for (const search of day.trendingSearches) {\n    const title = search.title.query.toLowerCase();\n    const isRelevant = sustainabilityKeywords.some(keyword => \n      title.includes(keyword)\n    );\n    \n    if (isRelevant) {\n      // Erstelle eindeutigen Hash f√ºr diesen Trend\n      const trendContent = JSON.stringify({\n        query: search.title.query,\n        date: day.date,\n        traffic: search.formattedTraffic\n      });\n      \n      const trendHash = crypto.createHash('sha256')\n        .update(trendContent)\n        .digest('hex');\n      \n      relevantTrends.push({\n        query: search.title.query,\n        traffic: search.formattedTraffic,\n        articles: search.articles || [],\n        date: day.date,\n        trendHash: trendHash,\n        sourceData: search\n      });\n    }\n  }\n}\n\nreturn relevantTrends.map(trend => ({ json: trend }));"
      },
      "id": "filter-trends",
      "name": "Nachhaltigkeits-Trends filtern + Hash",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://greenmindshift.com/api/trends/check-processed",
        "options": {
          "headers": {
            "Authorization": "Bearer {{$env.BLOG_API_TOKEN}}",
            "Content-Type": "application/json"
          }
        },
        "jsonParameters": true,
        "bodyParametersJson": "{\n  \"trendHash\": \"{{$json.trendHash}}\",\n  \"query\": \"{{$json.query}}\",\n  \"date\": \"{{$json.date}}\"\n}"
      },
      "id": "check-duplicate",
      "name": "Duplikat pr√ºfen",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.isProcessed}}",
              "value2": false
            }
          ]
        }
      },
      "id": "is-new-trend",
      "name": "Ist neuer Trend?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://greenmindshift.com/api/trends/blacklist-check",
        "options": {
          "headers": {
            "Authorization": "Bearer {{$env.BLOG_API_TOKEN}}",\n            \"Content-Type\": \"application/json\"\n          }\n        },\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"{\n  \\\"query\\\": \\\"{{$('filter-trends').all()[0].json.query}}\\\"\n}\"\n      },\n      \"id\": \"blacklist-check\",\n      \"name\": \"Blacklist pr√ºfen\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [1250, 200]\n    },\n    {\n      \"parameters\": {\n        \"conditions\": {\n          \"boolean\": [\n            {\n              \"value1\": \"={{$json.isBlacklisted}}\",\n              \"value2\": false\n            }\n          ]\n        }\n      },\n      \"id\": \"not-blacklisted\",\n      \"name\": \"Nicht auf Blacklist?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"typeVersion\": 1,\n      \"position\": [1450, 200]\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"https://greenmindshift.com/api/trends/mark-processing\",\n        \"options\": {\n          \"headers\": {\n            \"Authorization\": \"Bearer {{$env.BLOG_API_TOKEN}}\",\n            \"Content-Type\": \"application/json\"\n          }\n        },\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"{\n  \\\"trendHash\\\": \\\"{{$('filter-trends').all()[0].json.trendHash}}\\\",\n  \\\"query\\\": \\\"{{$('filter-trends').all()[0].json.query}}\\\",\n  \\\"traffic\\\": \\\"{{$('filter-trends').all()[0].json.traffic}}\\\",\n  \\\"date\\\": \\\"{{$('filter-trends').all()[0].json.date}}\\\",\n  \\\"sourceData\\\": {{JSON.stringify($('filter-trends').all()[0].json.sourceData)}}\n}\"\n      },\n      \"id\": \"mark-processing\",\n      \"name\": \"Als 'in Bearbeitung' markieren\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [1650, 200]\n    },\n    {\n      \"parameters\": {\n        \"method\": \"GET\",\n        \"url\": \"https://www.googleapis.com/customsearch/v1\",\n        \"options\": {\n          \"queryParameters\": {\n            \"key\": \"={{$env.GOOGLE_SEARCH_API_KEY}}\",\n            \"cx\": \"={{$env.GOOGLE_SEARCH_ENGINE_ID}}\",\n            \"q\": \"={{$('filter-trends').all()[0].json.query}} nachhaltigkeit umwelt\",\n            \"num\": \"5\",\n            \"lr\": \"lang_de\"\n          }\n        }\n      },\n      \"id\": \"google-search\",\n      \"name\": \"Google Suche\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [1850, 200]\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Content-Hash f√ºr Duplikatserkennung erstellen\\nconst crypto = require('crypto');\\n\\nconst searchResults = $input.all()[0].json;\\nconst trendData = $('filter-trends').all()[0].json;\\n\\n// Erstelle Content-Hash basierend auf Suchergebnissen\\nconst contentForHash = searchResults.items ? \\n  searchResults.items.map(item => item.title + ' ' + item.snippet).join(' ') : '';\\n\\nconst contentHash = crypto.createHash('sha256')\\n  .update(contentForHash + trendData.query)\\n  .digest('hex');\\n\\nreturn [{\\n  json: {\\n    ...trendData,\\n    searchResults: searchResults,\\n    contentHash: contentHash\\n  }\\n}];\"\n      },\n      \"id\": \"create-content-hash\",\n      \"name\": \"Content-Hash erstellen\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [2050, 200]\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"https://greenmindshift.com/api/content/check-hash\",\n        \"options\": {\n          \"headers\": {\n            \"Authorization\": \"Bearer {{$env.BLOG_API_TOKEN}}\",\n            \"Content-Type\": \"application/json\"\n          }\n        },\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"{\n  \\\"contentHash\\\": \\\"{{$json.contentHash}}\\\"\n}\"\n      },\n      \"id\": \"check-content-duplicate\",\n      \"name\": \"Content-Duplikat pr√ºfen\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [2250, 200]\n    },\n    {\n      \"parameters\": {\n        \"conditions\": {\n          \"boolean\": [\n            {\n              \"value1\": \"={{$json.exists}}\",\n              \"value2\": false\n            }\n          ]\n        }\n      },\n      \"id\": \"content-is-unique\",\n      \"name\": \"Content ist einzigartig?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"typeVersion\": 1,\n      \"position\": [2450, 200]\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"options\": {\n          \"headers\": {\n            \"Content-Type\": \"application/json\"\n          }\n        },\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"{\n  \\\"contents\\\": [{\n    \\\"parts\\\": [{\n      \\\"text\\\": \\\"Erstelle einen informativen Blog-Artikel auf Deutsch √ºber das Thema '{{$('create-content-hash').all()[0].json.query}}' mit Fokus auf Nachhaltigkeit. Der Artikel soll:\\n\\n1. Eine ansprechende √úberschrift haben\\n2. Eine kurze Einleitung (2-3 S√§tze)\\n3. 3-4 Hauptabschnitte mit Unter√ºberschriften\\n4. Praktische Tipps f√ºr den Alltag\\n5. Ein Fazit\\n6. SEO-optimiert sein\\n\\nVerwende folgende Informationen als Basis:\\n{{$('create-content-hash').all()[0].json.searchResults.items ? $('create-content-hash').all()[0].json.searchResults.items.map(item => item.title + ': ' + item.snippet).join('\\\\n\\\\n') : 'Keine Suchergebnisse verf√ºgbar'}}\\n\\nFormat: JSON mit den Feldern title, excerpt, content, seoTitle, seoDescription, tags\\\"\n    }]\n  }]\n}\"\n      },\n      \"id\": \"gemini-ai\",\n      \"name\": \"Gemini AI Content Generation\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [2650, 200]\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Parse Gemini Response und erstelle Blog Post Daten\\nconst response = $input.all()[0].json;\\nconst content = response.candidates[0].content.parts[0].text;\\nconst trendData = $('create-content-hash').all()[0].json;\\n\\n// Extrahiere JSON aus der Antwort\\nlet blogData;\\ntry {\\n  const jsonMatch = content.match(/\\\\{[\\\\s\\\\S]*\\\\}/);\\n  if (jsonMatch) {\\n    blogData = JSON.parse(jsonMatch[0]);\\n  } else {\\n    throw new Error('Kein JSON gefunden');\\n  }\\n} catch (error) {\\n  // Fallback: Manuell parsen\\n  blogData = {\\n    title: content.split('\\\\n')[0].replace(/^#+\\\\s*/, ''),\\n    excerpt: content.split('\\\\n').slice(1, 3).join(' '),\\n    content: content,\\n    seoTitle: content.split('\\\\n')[0].replace(/^#+\\\\s*/, ''),\\n    seoDescription: content.split('\\\\n').slice(1, 3).join(' ').substring(0, 160),\\n    tags: ['nachhaltigkeit', 'umwelt']\\n  };\\n}\\n\\n// Erstelle Slug aus Titel\\nconst slug = blogData.title\\n  .toLowerCase()\\n  .replace(/√§/g, 'ae')\\n  .replace(/√∂/g, 'oe')\\n  .replace(/√º/g, 'ue')\\n  .replace(/√ü/g, 'ss')\\n  .replace(/[^a-z0-9\\\\s-]/g, '')\\n  .replace(/\\\\s+/g, '-')\\n  .replace(/-+/g, '-')\\n  .trim('-');\\n\\nreturn [{\\n  json: {\\n    ...blogData,\\n    slug,\\n    status: 'REVIEW', // Zur manuellen √úberpr√ºfung\\n    aiGenerated: true,\\n    sourceHash: trendData.trendHash,\\n    trendsData: trendData,\\n    contentHash: trendData.contentHash\\n  }\\n}];\"\n      },\n      \"id\": \"process-content\",\n      \"name\": \"Content verarbeiten\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [2850, 200]\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"https://greenmindshift.com/api/articles\",\n        \"options\": {\n          \"headers\": {\n            \"Authorization\": \"Bearer {{$env.BLOG_API_TOKEN}}\",\n            \"Content-Type\": \"application/json\"\n          }\n        },\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"={{JSON.stringify($json)}}\"\n      },\n      \"id\": \"create-blog-post\",\n      \"name\": \"Blog Post erstellen\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [3050, 200]\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"https://greenmindshift.com/api/trends/mark-completed\",\n        \"options\": {\n          \"headers\": {\n            \"Authorization\": \"Bearer {{$env.BLOG_API_TOKEN}}\",\n            \"Content-Type\": \"application/json\"\n          }\n        },\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"{\n  \\\"trendHash\\\": \\\"{{$('process-content').all()[0].json.sourceHash}}\\\",\n  \\\"articleId\\\": \\\"{{$('create-blog-post').all()[0].json.id}}\\\"\n}\"\n      },\n      \"id\": \"mark-completed\",\n      \"name\": \"Als abgeschlossen markieren\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [3250, 200]\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"https://greenmindshift.com/api/content/store-hash\",\n        \"options\": {\n          \"headers\": {\n            \"Authorization\": \"Bearer {{$env.BLOG_API_TOKEN}}\",\n            \"Content-Type\": \"application/json\"\n          }\n        },\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"{\n  \\\"contentHash\\\": \\\"{{$('process-content').all()[0].json.contentHash}}\\\",\n  \\\"title\\\": \\\"{{$('process-content').all()[0].json.title}}\\\",\n  \\\"source\\\": \\\"google_trends\\\"\n}\"\n      },\n      \"id\": \"store-content-hash\",\n      \"name\": \"Content-Hash speichern\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [3450, 200]\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"{{$env.SLACK_WEBHOOK_URL}}\",\n        \"options\": {\n          \"headers\": {\n            \"Content-Type\": \"application/json\"\n          }\n        },\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"{\n  \\\"text\\\": \\\"üå± Neuer AI-generierter Blog Post erstellt!\\\",\n  \\\"blocks\\\": [\n    {\n      \\\"type\\\": \\\"section\\\",\n      \\\"text\\\": {\n        \\\"type\\\": \\\"mrkdwn\\\",\n        \\\"text\\\": \\\"*{{$('process-content').all()[0].json.title}}*\\\\n\\\\n{{$('process-content').all()[0].json.excerpt}}\\\\n\\\\n<https://greenmindshift.com/admin/articles/{{$('create-blog-post').all()[0].json.id}}|Artikel √ºberpr√ºfen>\\\"\n      }\n    }\n  ]\n}\"\n      },\n      \"id\": \"slack-notification\",\n      \"name\": \"Slack Benachrichtigung\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [3650, 200]\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"{{$env.SLACK_WEBHOOK_URL}}\",\n        \"options\": {\n          \"headers\": {\n            \"Content-Type\": \"application/json\"\n          }\n        },\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"{\n  \\\"text\\\": \\\"‚ö†Ô∏è Trend √ºbersprungen\\\",\n  \\\"blocks\\\": [\n    {\n      \\\"type\\\": \\\"section\\\",\n      \\\"text\\\": {\n        \\\"type\\\": \\\"mrkdwn\\\",\n        \\\"text\\\": \\\"Trend '{{$('filter-trends').all()[0].json.query}}' wurde √ºbersprungen.\\\\nGrund: Bereits verarbeitet oder auf Blacklist.\\\"\n      }\n    }\n  ]\n}\"\n      },\n      \"id\": \"skip-notification\",\n      \"name\": \"Skip Benachrichtigung\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.1,\n      \"position\": [1250, 400]\n    }\n  ],\n  \"connections\": {\n    \"T√§glich um 9:00 Uhr\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Google Trends abrufen\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Trends abrufen\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Nachhaltigkeits-Trends filtern + Hash\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Nachhaltigkeits-Trends filtern + Hash\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Duplikat pr√ºfen\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Duplikat pr√ºfen\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Ist neuer Trend?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Ist neuer Trend?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Blacklist pr√ºfen\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Skip Benachrichtigung\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Blacklist pr√ºfen\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Nicht auf Blacklist?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Nicht auf Blacklist?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Als 'in Bearbeitung' markieren\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Skip Benachrichtigung\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Als 'in Bearbeitung' markieren\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Google Suche\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Suche\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Content-Hash erstellen\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Content-Hash erstellen\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Content-Duplikat pr√ºfen\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Content-Duplikat pr√ºfen\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Content ist einzigartig?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Content ist einzigartig?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Gemini AI Content Generation\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Skip Benachrichtigung\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gemini AI Content Generation\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Content verarbeiten\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Content verarbeiten\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Blog Post erstellen\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Blog Post erstellen\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Als abgeschlossen markieren\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Als abgeschlossen markieren\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Content-Hash speichern\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Content-Hash speichern\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Slack Benachrichtigung\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  },\n  \"active\": true,\n  \"settings\": {\n    \"timezone\": \"Europe/Berlin\"\n  },\n  \"versionId\": \"2\"\n}"
  ]
} 